<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>SimpleTrans.java</title>


<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="KEYWORDS" content="JBuilderHtml"></head><body style="background-color: rgb(255, 255, 255);">
<table bgcolor="#c0c0c0" cellpadding="5" cellspacing="0" cols="1" width="100%">
<tbody>
<tr>
<td>
<center> <font color="#000000" face="Arial,Helvetica">SimpleTrans.java</font> </center>
</td>
</tr>
</tbody>
</table>
<pre><font color="#000080"><span style="color: rgb(0, 0, 0);"><span style="font-weight: bold; color: rgb(0, 0, 128);">import</span><span style="color: rgb(0, 0, 128);"> </span>java.sql.*;</span><br style="color: rgb(0, 0, 0);"><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"><span style="font-weight: bold; color: rgb(0, 0, 128);">public</span><span style="color: rgb(0, 0, 128);"> </span><span style="font-weight: bold; color: rgb(0, 0, 128);">class</span> SimpleTrans {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">static</span><span style="color: rgb(0, 0, 128);"> </span><span style="font-weight: bold; color: rgb(0, 0, 128);">final</span> String CONN_URL = <span style="color: rgb(0, 0, 255);">"</span></span></font><font><font color="#0000ff">jdbc:oracle:thin:@oracle1.ensimag.fr:1521:oracle1</font></font><font color="#000080"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 255);">"</span>;</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">static</span><span style="color: rgb(0, 0, 128);"> </span><span style="font-weight: bold; color: rgb(0, 0, 128);">final</span> String USER = <span style="color: rgb(0, 0, 255);">"scott"</span>; <span style="color: rgb(0, 128, 0);">// A remplacer pour votre compte, sinon genere une exception</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">static</span><span style="color: rgb(0, 0, 128);"> </span><span style="font-weight: bold; color: rgb(0, 0, 128);">final</span> String PASSWD = <span style="color: rgb(0, 0, 255);">"tiger"</span>;</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">public</span><span style="color: rgb(0, 0, 128);"> </span>SimpleTrans() {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">try</span><span style="color: rgb(0, 0, 128);"> </span>{</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 128, 0);">// Enregistrement du driver Oracle</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(<span style="color: rgb(0, 0, 255);">"Loading Oracle thin driver..."</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(<span style="color: rgb(0, 0, 255);">"loaded."</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 128, 0);">// Etablissement de la connexion</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(<span style="color: rgb(0, 0, 255);">"Connecting to the database..."</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> Connection conn = DriverManager.getConnection(CONN_URL, USER, PASSWD);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(<span style="color: rgb(0, 0, 255);">"connected."</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 128, 0);">// Demarrage de la transaction (implicite dans notre cas)</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> conn.setAutoCommit(false);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> conn.setTransactionIsolation(conn.TRANSACTION_SERIALIZABLE);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 128, 0);">// Execution des requetes</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> PreparedStatement pstmt = conn.prepareStatement</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> (<span style="color: rgb(0, 0, 255);">"select * from CineSalles where nbplaces &gt; ? and NomCine like ?"</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(<span style="color: rgb(0, 0, 255);">"Salles de plus de 200 places des cinemas commencant par L : "</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> pstmt.setInt(1, 200);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> pstmt.setString(2, <span style="color: rgb(0, 0, 255);">"L%"</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> ResultSet rset = pstmt.executeQuery();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> dumpResult(rset);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> rset.close();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(<span style="color: rgb(0, 0, 255);">"Salles de plus de 300 places des cinemas UGC : "</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> pstmt.setInt(1, 300);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> pstmt.setString(2, <span style="color: rgb(0, 0, 255);">"UGC%"</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> rset = pstmt.executeQuery();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> dumpResult(rset);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> rset.close();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 128, 0);">// Terminaison de la transaction</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> conn.commit();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 128, 0);">// Fermetures</span></span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> pstmt.close();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> conn.close();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> }</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">catch</span><span style="color: rgb(0, 0, 128);"> </span>(SQLException e) {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.err.println(<span style="color: rgb(0, 0, 255);">"failed !"</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> e.printStackTrace();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> }</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> }</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">void</span><span style="color: rgb(0, 0, 128);"> </span>dumpResult(ResultSet r) throws SQLException {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">while</span><span style="color: rgb(0, 0, 128);"> </span>(r.next()) {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> System.out.println(</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 0, 255);">"Cinema: "</span> + r.getString(1) +</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 0, 255);">"- Salle: "</span> + r.getString(2) +</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="color: rgb(0, 0, 255);">" - "</span> + r.getInt(3) + <span style="color: rgb(0, 0, 255);">" places."</span>);</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> }</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> }</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> </span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> <span style="font-weight: bold; color: rgb(0, 0, 128);">public</span><span style="color: rgb(0, 0, 128);"> </span><span style="font-weight: bold; color: rgb(0, 0, 128);">static</span><span style="color: rgb(0, 0, 128);"> </span><span style="font-weight: bold; color: rgb(0, 0, 128);">void</span> main(String args[]) {</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> new SimpleTrans();</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);"> }</span><br style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0);">}</span><b><br></b></font><font color="#000000"><br></font>
</pre>
<table bgcolor="#c0c0c0" cellpadding="5" cellspacing="0" cols="1" width="100%">
<tbody>
<tr>
<td>
<center> <font color="#000000" face="Arial,Helvetica">SimpleTrans.java</font> </center>
</td>
</tr>
</tbody>
</table>
</body></html>